<!DOCTYPE html>
<html lang="nl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woordjesleren - Studieblaadje Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/ico.svg" type="image/svg+xml">
    <style>
        :root {
            --outline-variant: #49453F;
            --surface-container-high: #2E2D2A;
            --on-surface-variant: #CAC5BC;
            --outline: #9A9084;
            --primary-container: #53452B;
            --on-primary-container: #E4DCC1;
            --surface-container-low: #1F1E1B;
            --on-surface: #EBE0D4;
        }
        .canvas-container-wrapper {
            border: 2px solid var(--outline-variant);
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
            background-color: #fff;
            aspect-ratio: 1 / 1.414; 
        }
        #drawing-canvas {
            width: 100%;
            height: 100%;
        }
        .styled-input {
            background-color: var(--surface-container-high);
            color: var(--on-surface-variant);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            border: 1px solid var(--outline);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .styled-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(83, 69, 43, 0.5);
        }
        /* Stijl voor de icoontjes in de dropdown */
        .icon-option-select {
            font-family: 'Material Symbols Outlined';
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div>
                <div class="sidebar-header">
                    <div class="icon-bg">
                        <span class="material-symbols-outlined">menu_book</span>
                    </div>
                    <h1>PWW Planner</h1>
                </div>
                <nav>
                    <ul class="nav-list">
                        <li><a href="/" class="m3-nav-item"><span class="material-symbols-outlined">dashboard</span><span>Dashboard</span></a></li>
                        <li><a href="/vakken" class="m3-nav-item"><span class="material-symbols-outlined">library_books</span><span>Mijn Vakken</span></a></li>
                        <li><a href="/planner" class="m3-nav-item"><span class="material-symbols-outlined">calendar_month</span><span>Planner</span></a></li>
                        <li><a href="/study-planner" class="m3-nav-item"><span class="material-symbols-outlined">calendar_view_day</span><span>Studieplanner</span></a></li>
                        <li><a href="/bestanden" class="m3-nav-item"><span class="material-symbols-outlined">folder_open</span><span>Bestanden</span></a></li>
                        <li><a href="/woordjes-leren.html" class="m3-nav-item"><span class="material-symbols-outlined">school</span><span>Woordjes Leren</span></a></li>
                        <li><a href="/pdf-maker.html" class="m3-nav-item active"><span class="material-symbols-outlined">draw</span><span>PDF Maker</span></a></li>
                    </ul>
                </nav>
            </div>
            <div class="sidebar-footer">
                <a href="/nieuw-item" class="button button-primary">
                    <span class="material-symbols-outlined">add</span>
                    <span>Nieuw Item</span>
                </a>
                <button id="collapse-btn" class="button">
                    <span class="material-symbols-outlined">chevron_left</span>
                </button>
            </div>
        </aside>
        <main class="main-content">
            <header class="header mb-4">
                <h2 class="text-2xl font-bold">Studieblaadje Generator</h2>
                <p class="text-gray-400">Vul de titel in, selecteer een vak, kies een icoon en download of print je blanco studieblaadje.</p>
            </header>

            <div id="settings-section" class="mt-4 p-4 rounded-lg flex items-end gap-4 flex-wrap" style="background-color: var(--surface-container-high);">
                <div class="flex-grow">
                    <label for="sheet-title" class="text-sm text-on-surface-variant block mb-1">Titel van het blaadje:</label>
                    <input type="text" id="sheet-title" class="styled-input w-full" placeholder="Bijv. Wiskunde hoofdstuk 3">
                </div>
                <div>
                    <label for="subject-select" class="text-sm text-on-surface-variant block mb-1">Selecteer een vak:</label>
                    <select id="subject-select" class="styled-input">
                        <option value="">Geen vak geselecteerd</option>
                        <option value="Wiskunde">Wiskunde</option>
                        <option value="Nederlands">Nederlands</option>
                        <option value="Geschiedenis">Geschiedenis</option>
                        <option value="Biologie">Biologie</option>
                        <option value="Engels">Engels</option>
                        <option value="Scheikunde">Scheikunde</option>
                        <option value="Natuurkunde">Natuurkunde</option>
                        <option value="Aardrijkskunde">Aardrijkskunde</option>
                        <option value="Informatica">Informatica</option>
                        <option value="Economie">Economie</option>
                    </select>
                </div>
                <div>
                    <label for="icon-select" class="text-sm text-on-surface-variant block mb-1">Kies een icoon:</label>
                    <select id="icon-select" class="styled-input icon-option-select">
                        <option value="menu_book">menu_book</option>
                        <option value="school">school</option>
                        <option value="lightbulb">lightbulb</option>
                        <option value="question_mark">question_mark</option>
                        <option value="star">star</option>
                        <option value="push_pin">push_pin</option>
                        <option value="edit">edit</option>
                        <option value="science">science</option>
                        <option value="language">language</option>
                        <option value="history_edu">history_edu</option>
                        <option value="calculate">calculate</option>
                        <option value="computer">computer</option>
                        <option value="globe">globe</option>
                    </select>
                </div>
                <button id="download-pdf-btn" class="button button-primary">Download PDF</button>
                <button id="print-pdf-btn" class="button button-secondary">Print PDF</button>
            </div>

            <div id="preview-container" class="mt-4">
                <h3 class="text-lg font-medium mb-2">Voorbeeld van het Studieblaadje</h3>
                <div class="canvas-container-wrapper">
                    <canvas id="drawing-canvas" width="700" height="990"></canvas>
                </div>
            </div>

            <p id="feedback-message" class="text-green-400 mt-2 h-5"></p>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = new fabric.Canvas('drawing-canvas', {
                backgroundColor: '#ffffff',
                isDrawingMode: false,
                selection: false,
                interactive: false,
            });

            // --- DOM Elements ---
            const sheetTitleInput = document.getElementById('sheet-title');
            const subjectSelect = document.getElementById('subject-select');
            const iconSelect = document.getElementById('icon-select');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');
            const printPdfBtn = document.getElementById('print-pdf-btn'); // Nieuwe printknop
            const feedbackMessage = document.getElementById('feedback-message');

            // --- Functie om de template te tekenen ---
            function drawTemplate() {
                canvas.clear();
                
                const title = sheetTitleInput.value || 'Titel van het blaadje';
                const subject = subjectSelect.options[subjectSelect.selectedIndex]?.textContent || 'Geen Vak Geselecteerd';
                const selectedIcon = iconSelect.value;

                // Teken een eenvoudige paginarand
                const border = new fabric.Rect({
                    left: 20,
                    top: 20,
                    width: canvas.getWidth() - 40,
                    height: canvas.getHeight() - 40,
                    stroke: '#c0c0c0',
                    strokeWidth: 2,
                    fill: 'transparent',
                });
                canvas.add(border);

                // Voeg het icoon toe
                const iconText = new fabric.Text(selectedIcon, {
                    left: 40,
                    top: 40,
                    fontFamily: 'Material Symbols Outlined',
                    fontSize: 40,
                    fill: '#1f2937',
                });
                canvas.add(iconText);

                // Voeg de titel toe
                const titleText = new fabric.Text(title, {
                    left: 100,
                    top: 45,
                    fontFamily: 'Google Sans', // Zorg dat dit lettertype beschikbaar is
                    fontSize: 36,
                    fontWeight: 'bold',
                    fill: '#1f2937',
                });
                canvas.add(titleText);
                
                // Voeg het vak toe
                const subjectText = new fabric.Text(subject, {
                    left: 100,
                    top: 90,
                    fontFamily: 'Google Sans Text', // Zorg dat dit lettertype beschikbaar is
                    fontSize: 24,
                    fontStyle: 'italic',
                    fill: '#4b5563',
                });
                canvas.add(subjectText);

                // Teken gelinieerde lijnen
                const lineSpacing = 25;
                const leftMargin = 70;
                const rightMargin = canvas.getWidth() - 30;
                const topMargin = 150;
                const bottomMargin = canvas.getHeight() - 50;

                for (let i = topMargin; i < bottomMargin; i += lineSpacing) {
                    const line = new fabric.Line([leftMargin, i, rightMargin, i], {
                        stroke: '#e0e0e0',
                        strokeWidth: 1,
                    });
                    canvas.add(line);
                    canvas.sendToBack(line);
                }
                
                canvas.renderAll();
            }

            // --- Functie om de PDF te genereren (voor zowel download als print) ---
            function generatePdfBlob(title) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });

                const dataUrl = canvas.toDataURL({ format: 'png', quality: 1.0, multiplier: 2 });
                
                const a4Width = 210;
                const a4Height = 297;

                doc.addImage(dataUrl, 'PNG', 0, 0, a4Width, a4Height);
                return doc;
            }

            // --- Event Listeners ---
            sheetTitleInput.addEventListener('input', drawTemplate);
            subjectSelect.addEventListener('change', drawTemplate);
            iconSelect.addEventListener('change', drawTemplate);

            downloadPdfBtn.addEventListener('click', () => {
                const title = sheetTitleInput.value.trim();

                if (!title) {
                    feedbackMessage.textContent = 'Geef het blaadje een titel.';
                    feedbackMessage.style.color = '#ffb4ab';
                    return;
                }
                
                const originalText = downloadPdfBtn.textContent;
                downloadPdfBtn.textContent = 'Bezig met downloaden...';
                downloadPdfBtn.disabled = true;
                printPdfBtn.disabled = true;

                try {
                    const doc = generatePdfBlob(title);
                    doc.save(`${title.replace(/[^a-z0-9]/gi, '_')}.pdf`);

                    feedbackMessage.textContent = `'${title}.pdf' succesvol gegenereerd! De download start automatisch.`;
                    feedbackMessage.style.color = '#9cf890';
                    setTimeout(() => { feedbackMessage.textContent = ''; }, 4000);

                } catch (error) {
                    console.error('Download PDF error:', error);
                    feedbackMessage.textContent = `Fout: ${error.message}`;
                    feedbackMessage.style.color = '#ffb4ab';
                } finally {
                    downloadPdfBtn.textContent = originalText;
                    downloadPdfBtn.disabled = false;
                    printPdfBtn.disabled = false;
                }
            });

            printPdfBtn.addEventListener('click', () => {
                const title = sheetTitleInput.value.trim();

                if (!title) {
                    feedbackMessage.textContent = 'Geef het blaadje een titel.';
                    feedbackMessage.style.color = '#ffb4ab';
                    return;
                }
                
                const originalText = printPdfBtn.textContent;
                printPdfBtn.textContent = 'Bezig met printen...';
                printPdfBtn.disabled = true;
                downloadPdfBtn.disabled = true;

                try {
                    const doc = generatePdfBlob(title);
                    // Open de PDF in een nieuw venster om te printen
                    doc.output('dataurlnewwindow', {filename: `${title.replace(/[^a-z0-9]/gi, '_')}.pdf`});

                    feedbackMessage.textContent = `De PDF is geopend in een nieuw venster om te printen.`;
                    feedbackMessage.style.color = '#9cf890';
                    setTimeout(() => { feedbackMessage.textContent = ''; }, 4000);

                } catch (error) {
                    console.error('Print PDF error:', error);
                    feedbackMessage.textContent = `Fout: ${error.message}`;
                    feedbackMessage.style.color = '#ffb4ab';
                } finally {
                    printPdfBtn.textContent = originalText;
                    printPdfBtn.disabled = false;
                    downloadPdfBtn.disabled = false;
                }
            });

            // Initial load
            drawTemplate();
        });
    </script>
</body>
</html>